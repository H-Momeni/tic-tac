<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PeerJS Example</title>
</head>
<body>
    <h1>PeerJS Data Connection Example</h1>
    <button id="connectButton">Connect to Peer</button>
    <button id="sendButton">Send Message</button>
    <div id="messages"></div>

    <script src="https://cdn.jsdelivr.net/npm/peerjs/dist/peerjs.min.js"></script>
    <script>
        // Create a Peer instance
        const peer = new Peer("pick-an-id", {
            host: 'localhost',
            port: 9000,
            path: '/'
        });

        // Handle incoming connections
        peer.on('connection', (conn) => {
            conn.on('data', (data) => {
                // Append received message to messages div
                appendMessage(`Received: ${data}`);
            });
            conn.on('open', () => {
                conn.send('Hello! This is Peer 2.');
            });
        });

        // Button click handlers
        document.getElementById('connectButton').addEventListener('click', () => {
            const peerId = document.getElementById('peerIdInput').value; // Enter another peer's ID here
            const conn = peer.connect(peerId);

            conn.on('open', () => {
                appendMessage('Connected to Peer.');
            });

            conn.on('data', (data) => {
                appendMessage(`Received: ${data}`);
            });

            conn.on('close', () => {
                appendMessage('Connection closed.');
            });
        });

        document.getElementById('sendButton').addEventListener('click', () => {
            const message = document.getElementById('messageInput').value;
            const connectedPeers = Object.keys(peer.connections);

            connectedPeers.forEach(peerId => {
                const conn = peer.connect(peerId);
                conn.on('open', () => {
                    conn.send(message);
                    appendMessage(`Sent: ${message}`);
                });
            });
        });

        // Function to append messages to the messages div
        function appendMessage(message) {
            const messagesDiv = document.getElementById('messages');
            const p = document.createElement('p');
            p.textContent = message;
            messagesDiv.appendChild(p);
        }
    </script>
</body>
</html>
